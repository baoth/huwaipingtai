@{
    Layout = null;
}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <script src="../../Scripts/qsm-mui/zepto-1.1.4.min.js" type="text/javascript"></script>       

        <script type="text/javascript">
            $(document).ready(function () {
                $('.i-a-bh').on($.clickAction, function () {
                    var tg = $('.i-bh-tab');
                    if (tg.hasClass('on')) {
                        tg.removeClass('on');
                    }
                    else {
                        tg.addClass('on');
                    }
                });
                $('.i-a-back').on($.clickAction, function () {
                    window.location = window.sessionStorage.backurl;
                });
                InitData();
                LoadData();

            });
            var InitData = function () {
                
                var nickName = $("#NickName").val();
                if (!nickName) {
                    var aobj = (".btn-jd-gray btn-large");
                    if (!obj) {
                        var a = '<a href="javascript:GoLogin()" class="btn-jd-gray btn-large">去登录</a>';
                        $(".empty-btn-wrapper a:last").after(a);
                    }
                }
            }

            var LoadData = function () {                
                var url = "GetCartProductByCustomer";
                var para = { };
                submitAjax(url, para);               
            }

            var getHtml = function (data) {

                var sku = data["Sku"];
                var price = data["Price"] + "";
                price = price.formatCurrency();
                var quantity = data["Quantity"];
                var Actived = data["Actived"]; //checked
                if (Actived == "1" || Actived == "true") {
                    Actived = "checked";
                }
                else {
                    Actived = "";
                }
                var Description = data["Description"];
                if (!Description) {
                    Description = "";
                }
                var cartId = data["Id"];

                var li = '<li id="product{0}">'
	            + '<div class="items">'
                + ' <div class="cart-check-wrapper"> '
                + ' <span id="checkIcon{0}" class="cart-checkbox {3}" onclick="changeSelected(this,{0},1)"></span> '
                + ' </div> '
                + ' <div class="cart-item-core"> '
                + '  <div class="cart-product-cell-3"> '
                + '      <span class="cart-item-price" id="price{0}">￥{1}</span> '
                + '  </div> '
                + '  <a class="cart-product-cell-1" href="/product/{0}/index.html?sid=a0b43b56f4431a58b6e78b635837359c"> '
                + '      <img class="cart-photo-thumb" alt="" src="../../product/{0}/{0}.jpg" onerror="lib/skin/e/i/error-jd.gif"> '
                + '  </a> '
                + '  <div class="cart-product-cell-2"> '
                + '      <div class="cart-product-name"><a href="/product/{0}/index.html?pid=a0b43b56f4431a58b6e78b635837359c"><span>{4}</span></a></div>  '
                + '       <div class="cart-opt"> '
                + '          <div class="cart-quantity-wrapper"> '
                + '              <input type="hidden" id="limitSukNum{0}" value="200"> '
                + '              <a class="cart-quantity-decrease disabled" id="subnum{0}" href="javascript:subQuantityBybutton({0})">-</a> '
                + '              <input type="text" class="quantity" size="4" onchange="QuqntityChange({0},this.value)"   value="{2}" name="num" id="num{0}">  '
                + '              <a class="quantity-increase" id="addnum{0}" href="javascript:addQuantityBybutton({0})">+</a> '
                + '          </div>'
                + '          <a class="cart-icon-remove" href="javascript:deleteCartWare({5})"></a> '
                + '      </div> '
                + '  </div> '
                + '  </div>  '
                + ' <div class="cart-diver-hr-dashed"></div> '
	            + '</div> '
                + ' </li>'
                var liHtml = li.format(sku, price, quantity, Actived, Description, cartId);
                return liHtml;
            }

            var submitAjax = function (url, para) {
                $.ajax({
                    url: url,
                    data: para,
                    type: "POST",
                    dataType: "json",
                    success: function (data) {

                        var lis = "";
                        if (data && data.length > 0) {
                            for (var i = 0, j = data.length; i < j; i++) {
                                lis += getHtml(data[i]);
                            }
                        }
                        var objul = $("#notEmptyMyCart ul");
                        if (lis) {
                            var li = objul.find("li:last");
                            if (li && li.length > 0) {
                                objul.children().remove();
                                objul.html(lis);
                            }
                            else {
                                objul.html(lis);
                            }
                            //显示购物车
                            $("#notEmptyMyCart").show();
                            $("#payment").show();
                            //隐藏购物车
                            $("#emptyCart").hide();
                        }
                        else {
                            objul.html("");

                            //隐藏购物车
                            $("#notEmptyMyCart").hide();
                            $("#payment").hide();
                            //显示购物车
                            $("#emptyCart").show();
                        }
                        SetTotal(data);
                    },
                    error: function () {
                        alert("请求错误！");
                    }

                });
            }
            function deleteCartWare(id) {                
                if (confirm("确定要删除吗？")) {
                    // $("#product" + id).remove();                    
                    DeleteData(id);
                }
            }
            var DeleteData = function (productId) {
                var url = "Delete";
                var para = {pid: productId };
                submitAjax(url,para);              
            }
           
            function changeSelected(e,id) {
                var obj = $(e);
                var check = 0;
                if (obj.hasClass("checked")) {
                    // obj.removeClass("checked");
                    check =0;
                }
                else {
                    //obj.addClass("checked");
                    check = 1;
                }
                var url = "UpdateActived";
                var pStr = id + "," + check;
                var para ={para:pStr};

                submitAjax(url,para);
            }

            function checkAllProduct(e) {

                var obj = $(e);
                var actived=1;
                if (obj.hasClass("checked")) {
                    actived = 0;
                    obj.removeClass("checked");
                }
                else {
                    obj.addClass("checked");
                }

                var url = "UpdateActived";
                var para = { type: "all", actived: actived };

                submitAjax(url, para);     
            }
            function SetTotal(data) {
            
            var sumPrice = cartSumPrice(data);
                sumPrice=(sumPrice+"").formatCurrency();
                $("#cart_realPrice").html(sumPrice);

                //商品总额
                $("#cart_oriPrice").html(sumPrice);
                //返现
                $("#cart_rePrice").html("0.00");
                //结算数量
                var iCount = 0;
                iCount=cartProductCount(data);
                $("#checkedNum").html(iCount);
                //设置全选按钮状态
                var notCheckCount = 0;
                var actived = cartAcivedCount(data);
                if (data.length == actived)
                {
                    $("#payment .cart-checkbox").each(function () {
                        $(this).addClass("checked");
                    })
                }
                else
                {
                    $("#payment .cart-checkbox.checked").each(function () {
                        $(this).removeClass("checked");
                    })
                }
            }
            function cartSumPrice(data) {
                var sumTotal = 0.00;
                for(var i=0,j=data.length;i<j;i++ )
                {
                    var row=data[i];
                    if(row["Actived"]=="1")
                    {
                         var quantity=row["Quantity"];
                        if(quantity)
                        {
                            quantity=parseInt(quantity);
                        }
                        var price=row["Price"];
                        if(price)
                        {
                            price=parseFloat(price);
                        }
                        sumTotal+=quantity * price;
                    }
                }
                return sumTotal;

            }

            function cartProductCount(data)
            {
                var count=0;
                 for(var i=0,j=data.length;i<j;i++ )
                {
                    var row=data[i];
                    if(row["Actived"]=="1")
                    {
                         var quantity=row["Quantity"];
                        if(quantity)
                        {
                            quantity=parseInt(quantity);
                            count+=quantity;
                        }                        
                    }
                }
                return count;
            }

            function cartAcivedCount(data) {
                var count = 0;
                for (var i = 0, j = data.length; i < j; i++) {
                    var row = data[i];
                    if (row["Actived"] == "1") {
                        count++;
                    }
                }
                return count;
            }

            function addQuantityBybutton(productid) {
                var q = $("#num" + productid).val();
                if (q) {
                    q = parseInt(q);
                    q++;
                }
                $("#num" + productid).val(q);
                $("#num" + productid).attr("value",q);
                QuqntityChange(productid, q);
            }
            function subQuantityBybutton(productid) {
                var q = $("#num" + productid).val();
                if (q) {
                    q = parseInt(q);
                    if (q > 1) {
                        q--;
                    }
                }
                $("#num" + productid).val(q);
                $("#num" + productid).attr("value", q);
                QuqntityChange(productid,q);
            }
            function QuqntityChange(productid, value) {
                
                var url = "UpdateQuantity";                
                var para = { pid: productid,quantity:value};
                submitAjax(url, para);
            }
            function GoWalk() {
                window.location = window.location.origin + "/Product/1000000011/index.html";
            }
            function GoLogin() {
                window.location = window.location.origin + "/User/Logon";
            }
        </script>
      
        <style type="text/css">
            @@font-face
            {
        	    font-family:icons;
        	    src:url(../Scripts/qsm-mui/iconfont_141111.ttf) format('truetype');
        	    font-weight:400;
        	    font-style:normal;
            }
            *
            {
            	margin:0;
            	padding:0;
            }
            a
            {
            	text-decoration:none;
            }
            body
            {
            	line-height: 1.25em;
            	font-family: 'microsoft yahei',Verdana,Arial,Helvetica,sans-serif;
            }
            .i-bh-header
            {
                position: relative;
                height: 44px;
                background: #e4393c;
            }
            .i-bh-header h2 
            {
                height: 44px;
                line-height: 44px;
                font-weight: normal;
                font-size: 16px;
                color: #fff;
                text-align: center;
            }
            .i-a-back 
            {
                position: absolute;
                top: 6px;
                left: 6px;
                width: 30px;
                height: 32px;
            }
            .i-a-back span 
            {
                display: inline-block;
                width: 10px;
                height: 18px;
                margin-top: 6px;
                background: url(../Content/images/icon2b.png) -60px 0 no-repeat;
                background-size: 180px 180px;
                text-indent: -9999px;
            }
            .i-a-bh 
            {
                position: absolute;
                top: 6px;
                right: 12px;
                width: 37px;
                height: 30px;
            }
            .i-a-bh span 
            {
                display: inline-block;
                width: 21px;
                height: 21px;
                margin: 5px 0 0 13px;
                background: url(../Content/images/icon2b.png) -125px -24px no-repeat;
                background-size: 180px 180px;
                text-indent: -9999px;
            }
            .i-bh-tab
            {
                border-bottom: 1px solid #d0cece;
                background-color: #fff;
                display:none;
            }
            .i-bh-tab.on
            {
            	display:block;
            }
            .i-tbl-type 
            {
                display: table;
                width: 100%;
            }
            .i-bh-tab .i-tbl-cell 
            {
                width: 25%;
                padding: 9px 0;
                font-size: 12px;
                text-align: center;
                display: table-cell;
            }
            .i-bh-tab .i-tbl-cell span
            {
            	background: url(../Content/images/icon2b.png) -60px -25px no-repeat;
                background-size: 180px 180px;
                vertical-align: text-top;
                display: inline-block;
                width: 22px;
                height: 22px;
                color:#6e6e6e;
            }
            
            
            
           .new-ct 
            {
                min-height: 203px;
                background-color: #fff;
            }
            .title 
            {
                padding: 13px 10px 7px;
                border-bottom: 1px solid #c8c7cc;
                background: #f1f1f5;
                font-size: 14px;
                color: #666;
            }
            .cart-list
            {
                padding-left: 10px;
                border-bottom: 1px solid #c8c7cc;
            }
            .info-delv
            {
                padding: 13px 10px 12px;
                border-bottom: 1px solid #c8c7cc;
            }
            .info-delv.b-b-n
            {
                border-bottom: none;
            }
            .btn-radio 
            {
                display: inline-block;
                width: 22px;
                height: 22px;
                padding: 0;
                /*background: url(../Content/images/icon_order.png) -79px -50px no-repeat; */     
                background: url(../Content/images/icon_order.png) -29px -57px no-repeat;             
                background-size: 100px 100px;
                vertical-align: -5px;
            }
            .btn-radio.on 
            {
                /*background-position: -55px -50px;*/
                background-position:0px -56px
            }
            .mgn 
            {
                margin: 15px 10px;
            }
            .new-abtn-type
            {
                display: block;
                padding: 8px;
                border-radius: 2px;
                background-color: #c00;
                font-size: 14px;
                color: #fff;
                text-align: center;
            }
            
            
            
            
            
            .i-footer 
            {
                margin-top: 20px;
                background-color: #f3f2f2;
                font-size: 14px;
                color: #6e6e6e;
                text-align: center;
            }
            .i-footer .i-f-login 
            {
                /*position: relative;*/
                padding: 0 12px;
                background-color: #a8a8a8;
                line-height: 27px;
                color: #fff;
                text-align: left;
                heigth: 27px;
            }
            .i-footer .i-f-login a 
            {
                color: #fff;
            }
            .i-footer .i-f-login .i-bar2 
            {
                margin: 0 5px;
            }
            .i-footer .i-f-login .i-back-top 
            {
                position: absolute;
                right: 12px;
            }
            .i-footer .i-f-section, .i-footer .i-f-section2 
            {
                padding: 10px 0;
            }
            .i-footer .i-f-section a:first-child 
            {
                margin-left: 0;
            }
            .i-footer .i-f-section a 
            {
                margin-left: 20px;
                color: #6e6e6e;
            }
            .i-footer .i-f-section .on 
            {
                color: #c30202;
            }
        </style>
          
      
       <style>
         .success {         
            overflow: hidden;
            height: 65px;
            padding: 31px 10px 16px 80px;
            zoom: 1;
        }
       .success-b {
        color: #999;
        font: 12px/150% Arial,Verdana,"\5b8b\4f53";
        height: auto;
       
        }
        
        .success-b h3 {
        font: normal 24px/40px \5fae\8f6f\96c5\9ed1;
        color: #7ABD54;
        }
        .success-b {
        float: left;
        overflow: hidden;
        width: 304px;
        height: 40px;
        padding-left: 56px;
        background: url(../../Content/images/addToCart.png) no-repeat 0 -100px;
        font: normal 24px/40px \5fae\8f6f\96c5\9ed1;
        color: #7ABD54;
        }
        
        .btn-pay {
        float: right;
        width: 189px;
        height: 36px;
        margin: 0 25px 0 10px;
        _margin-right: 12px;
        background-position: 0 0;
        }
        .btn-pay,.btn-continue {
        background: #ccc url(../../Content/images/addToCart.png) no-repeat;
        line-height: 100px;
        overflow: hidden;
        display: block;
        }
        
        .btn-continue {
        float: right;
        background-position: -90px -37px;
        width: 94px;
        height: 36px;
        }
       </style>
    </head>
    <body>
        <a name="top"></a>
        <header>
            <div class='i-bh-header'>
                <a href="javascript:void(0);" class="i-a-back"><span>返回</span></a>
                <h2>购物车</h2>
                <a href="javascript:void(0);" class="i-a-bh"><span>易购键</span></a>
            </div>
            <div class='i-bh-tab'>
                <div class='i-tbl-type'>
                    <a href='#' class='i-tbl-cell'>
                        <span></span>
                        <p style='color:#6e6e6e;'>首页</p>
                    </a>
                    <a href='#' class='i-tbl-cell'>
                        <span style='width:26px;background-position:0 -25px;'></span>
                        <p style='color:#6e6e6e;'>分类搜索</p>
                    </a>
                    <a href='#' class='i-tbl-cell'>
                        <span style='width:25px;background-position:-29px -25px'></span>
                        <p style='color:#6e6e6e;'>购物车</p>
                    </a>
                    <a href='#' class='i-tbl-cell'>
                        <span style='width:22px;background-position:-85px -25px'></span>
                        <p style='color:#6e6e6e;'>我的易购</p>
                    </a>
                </div>
            </div>
        </header>
      
      
       <div class="success">
            <div class="success-b">
                <h3>商品已成功加入购物车！</h3>                
            </div>

            <span id="initCart_next_go">
              <a id="GotoShoppingCart" href="#" class="btn-pay">去结算</a>
              <a href="javascript:GoLogin()" class="btn-continue">继续购物</a>
            </span>

        </div>
        
        <footer>
            <div class='i-footer'>
                <div class='i-f-login'>
                    <a rel="nofollow" href='#'>tyrone</a>
                    <span class="i-bar2">|</span>
                    <a rel="nofollow" href="#">退出</a>
                    <span class="i-back-top">
                        <a href="javascript:void(0);">反馈</a>
                        
                    </span>
                </div>
                <div class="i-f-section">
                    <a href="#">标准版</a>
                    <a href="#" class="on">触屏版</a>
                    <a href="#" id="toPcHome">电脑版</a>
                </div>
                <div class="i-f-section2">Copyright © 2014-2015 baoth.com 版权所有</div>
            </div>
        </footer>
    </body>

</html>
